# Stiffness matrix for 8-noded brick

The stiffness matrix is computed by the following integral

$$ K = \int\limits_{[-1,1]^3} B^T C B\, |J| \mathrm{d}r\, \mathrm{d}s\, \mathrm{d}t$$

with $C$ the stiffness tensor in [Voigt notation](https://en.wikipedia.org/wiki/Voigt_notation), and $B$ the displacement-to-strain matrix. The 3 columns related to node $i$ of $B$ is of the form

$$B = \begin{bmatrix}
\frac{\mathrm{d} N_i}{\mathrm{d}x} & 0 & 0\\
0 &\frac{\mathrm{d} N_i}{\mathrm{d}y} & 0\\
0 & 0 &\frac{\mathrm{d} N_i}{\mathrm{d}z}\\
0 &\frac{\mathrm{d} N_i}{\mathrm{d}z} & \frac{\mathrm{d} N_i}{\mathrm{d}y}\\
\frac{\mathrm{d} N_i}{\mathrm{d}z} &0 & \frac{\mathrm{d} N_i}{\mathrm{d}x}\\
\frac{\mathrm{d} N_i}{dy} &\frac{\mathrm{d} N_i}{\mathrm{d}x} & 0
\end{bmatrix}$$

the remaining columns are similar, just change the index $i$. The indices correspond to the interpolation functions:

$$N = \begin{bmatrix}
\frac{1}{8} \left(- r + 1\right) \left(- s + 1\right) \left(t + 1\right)\\
\frac{1}{8} \left(r + 1\right) \left(- s + 1\right) \left(t + 1\right)\\
\frac{1}{8} \left(r + 1\right) \left(s + 1\right) \left(t + 1\right)\\
\frac{1}{8} \left(- r + 1\right) \left(s + 1\right) \left(t + 1\right)\\
\frac{1}{8} \left(- r + 1\right) \left(- s + 1\right) \left(- t + 1\right)\\
\frac{1}{8} \left(r + 1\right) \left(- s + 1\right) \left(- t + 1\right)\\
\frac{1}{8} \left(r + 1\right) \left(s + 1\right) \left(- t + 1\right)\\
\frac{1}{8} \left(- r + 1\right) \left(s + 1\right) \left(- t + 1\right)
\end{bmatrix}$$

Notice that the derivatives in $B$ are in $(x, y, z)$ and the interpolation functions are in $(r, s, t)$. And you would need to compute the chain derivates.

If we express the stiffness tensor as

$$C = \lambda C_1 + \mu C_2$$

with

$$C_1 = \begin{bmatrix}
1 & 1 & 1 & 0 & 0 & 0\\
1 & 1 & 1 & 0 & 0 & 0\\
1 & 1 & 1 & 0 & 0 & 0\\
0 & 0 & 0 & 0 & 0 & 0\\
0 & 0 & 0 & 0 & 0 & 0\\
0 & 0 & 0 & 0 & 0 & 0
\end{bmatrix}$$

and

$$C_2 = \begin{bmatrix}
2 & 0 & 0 & 0 & 0 & 0\\
0 & 2 & 0 & 0 & 0 & 0\\
0 & 0 & 2 & 0 & 0 & 0\\
0 & 0 & 0 & 1 & 0 & 0\\
0 & 0 & 0 & 0 & 1 & 0\\
0 & 0 & 0 & 0 & 0 & 1
\end{bmatrix}$$

And you split your stiffness matrix as $K = K_1 + K_2$, with

$$\frac{288 K_1}{L}= \begin{bmatrix}
8 & 6 & -6 & -8 & 6 & -6 & -4 & -6 & -3 & 4 & -6 & -3 & 4 & 3 & 6 & -4 & 3 & 6 & -2 & -3 & 3 & 2 & -3 & 3\\
6 & 8 & -6 & -6 & 4 & -3 & -6 & -4 & -3 & 6 & -8 & -6 & 3 & 4 & 6 & -3 & 2 & 3 & -3 & -2 & 3 & 3 & -4 & 6\\
-6 & -6 & 8 & 6 & -3 & 4 & 3 & 3 & 2 & -3 & 6 & 4 & -6 & -6 & -8 & 6 & -3 & -4 & 3 & 3 & -2 & -3 & 6 & -4\\
-8 & -6 & 6 & 8 & -6 & 6 & 4 & 6 & 3 & -4 & 6 & 3 & -4 & -3 & -6 & 4 & -3 & -6 & 2 & 3 & -3 & -2 & 3 & -3\\
6 & 4 & -3 & -6 & 8 & -6 & -6 & -8 & -6 & 6 & -4 & -3 & 3 & 2 & 3 & -3 & 4 & 6 & -3 & -4 & 6 & 3 & -2 & 3\\
-6 & -3 & 4 & 6 & -6 & 8 & 3 & 6 & 4 & -3 & 3 & 2 & -6 & -3 & -4 & 6 & -6 & -8 & 3 & 6 & -4 & -3 & 3 & -2\\
-4 & -6 & 3 & 4 & -6 & 3 & 8 & 6 & 6 & -8 & 6 & 6 & -2 & -3 & -3 & 2 & -3 & -3 & 4 & 3 & -6 & -4 & 3 & -6\\
-6 & -4 & 3 & 6 & -8 & 6 & 6 & 8 & 6 & -6 & 4 & 3 & -3 & -2 & -3 & 3 & -4 & -6 & 3 & 4 & -6 & -3 & 2 & -3\\
-3 & -3 & 2 & 3 & -6 & 4 & 6 & 6 & 8 & -6 & 3 & 4 & -3 & -3 & -2 & 3 & -6 & -4 & 6 & 6 & -8 & -6 & 3 & -4\\
4 & 6 & -3 & -4 & 6 & -3 & -8 & -6 & -6 & 8 & -6 & -6 & 2 & 3 & 3 & -2 & 3 & 3 & -4 & -3 & 6 & 4 & -3 & 6\\
-6 & -8 & 6 & 6 & -4 & 3 & 6 & 4 & 3 & -6 & 8 & 6 & -3 & -4 & -6 & 3 & -2 & -3 & 3 & 2 & -3 & -3 & 4 & -6\\
-3 & -6 & 4 & 3 & -3 & 2 & 6 & 3 & 4 & -6 & 6 & 8 & -3 & -6 & -4 & 3 & -3 & -2 & 6 & 3 & -4 & -6 & 6 & -8\\
4 & 3 & -6 & -4 & 3 & -6 & -2 & -3 & -3 & 2 & -3 & -3 & 8 & 6 & 6 & -8 & 6 & 6 & -4 & -6 & 3 & 4 & -6 & 3\\
3 & 4 & -6 & -3 & 2 & -3 & -3 & -2 & -3 & 3 & -4 & -6 & 6 & 8 & 6 & -6 & 4 & 3 & -6 & -4 & 3 & 6 & -8 & 6\\
6 & 6 & -8 & -6 & 3 & -4 & -3 & -3 & -2 & 3 & -6 & -4 & 6 & 6 & 8 & -6 & 3 & 4 & -3 & -3 & 2 & 3 & -6 & 4\\
-4 & -3 & 6 & 4 & -3 & 6 & 2 & 3 & 3 & -2 & 3 & 3 & -8 & -6 & -6 & 8 & -6 & -6 & 4 & 6 & -3 & -4 & 6 & -3\\
3 & 2 & -3 & -3 & 4 & -6 & -3 & -4 & -6 & 3 & -2 & -3 & 6 & 4 & 3 & -6 & 8 & 6 & -6 & -8 & 6 & 6 & -4 & 3\\
6 & 3 & -4 & -6 & 6 & -8 & -3 & -6 & -4 & 3 & -3 & -2 & 6 & 3 & 4 & -6 & 6 & 8 & -3 & -6 & 4 & 3 & -3 & 2\\
-2 & -3 & 3 & 2 & -3 & 3 & 4 & 3 & 6 & -4 & 3 & 6 & -4 & -6 & -3 & 4 & -6 & -3 & 8 & 6 & -6 & -8 & 6 & -6\\
-3 & -2 & 3 & 3 & -4 & 6 & 3 & 4 & 6 & -3 & 2 & 3 & -6 & -4 & -3 & 6 & -8 & -6 & 6 & 8 & -6 & -6 & 4 & -3\\
3 & 3 & -2 & -3 & 6 & -4 & -6 & -6 & -8 & 6 & -3 & -4 & 3 & 3 & 2 & -3 & 6 & 4 & -6 & -6 & 8 & 6 & -3 & 4\\
2 & 3 & -3 & -2 & 3 & -3 & -4 & -3 & -6 & 4 & -3 & -6 & 4 & 6 & 3 & -4 & 6 & 3 & -8 & -6 & 6 & 8 & -6 & 6\\
-3 & -4 & 6 & 3 & -2 & 3 & 3 & 2 & 3 & -3 & 4 & 6 & -6 & -8 & -6 & 6 & -4 & -3 & 6 & 4 & -3 & -6 & 8 & -6\\
3 & 6 & -4 & -3 & 3 & -2 & -6 & -3 & -4 & 6 & -6 & -8 & 3 & 6 & 4 & -3 & 3 & 2 & -6 & -3 & 4 & 6 & -6 & 8
\end{bmatrix}$$

and

$$ \frac{288 K_2}{L} = \begin{bmatrix}
32 & 6 & -6 & -8 & -6 & 6 & -10 & -6 & 3 & 4 & 6 & -3 & 4 & 3 & -6 & -10 & -3 & 6 & -8 & -3 & 3 & -4 & 3 & -3\\
6 & 32 & -6 & 6 & 4 & -3 & -6 & -10 & 3 & -6 & -8 & 6 & 3 & 4 & -6 & 3 & -4 & -3 & -3 & -8 & 3 & -3 & -10 & 6\\
-6 & -6 & 32 & -6 & -3 & 4 & -3 & -3 & -4 & -3 & -6 & 4 & 6 & 6 & -8 & 6 & 3 & -10 & 3 & 3 & -8 & 3 & 6 & -10\\
-8 & 6 & -6 & 32 & -6 & 6 & 4 & -6 & 3 & -10 & 6 & -3 & -10 & 3 & -6 & 4 & -3 & 6 & -4 & -3 & 3 & -8 & 3 & -3\\
-6 & 4 & -3 & -6 & 32 & -6 & 6 & -8 & 6 & 6 & -10 & 3 & -3 & -4 & -3 & -3 & 4 & -6 & 3 & -10 & 6 & 3 & -8 & 3\\
6 & -3 & 4 & 6 & -6 & 32 & 3 & -6 & 4 & 3 & -3 & -4 & -6 & 3 & -10 & -6 & 6 & -8 & -3 & 6 & -10 & -3 & 3 & -8\\
-10 & -6 & -3 & 4 & 6 & 3 & 32 & 6 & 6 & -8 & -6 & -6 & -8 & -3 & -3 & -4 & 3 & 3 & 4 & 3 & 6 & -10 & -3 & -6\\
-6 & -10 & -3 & -6 & -8 & -6 & 6 & 32 & 6 & 6 & 4 & 3 & -3 & -8 & -3 & -3 & -10 & -6 & 3 & 4 & 6 & 3 & -4 & 3\\
3 & 3 & -4 & 3 & 6 & 4 & 6 & 6 & 32 & 6 & 3 & 4 & -3 & -3 & -8 & -3 & -6 & -10 & -6 & -6 & -8 & -6 & -3 & -10\\
4 & -6 & -3 & -10 & 6 & 3 & -8 & 6 & 6 & 32 & -6 & -6 & -4 & -3 & -3 & -8 & 3 & 3 & -10 & 3 & 6 & 4 & -3 & -6\\
6 & -8 & -6 & 6 & -10 & -3 & -6 & 4 & 3 & -6 & 32 & 6 & 3 & -10 & -6 & 3 & -8 & -3 & -3 & -4 & 3 & -3 & 4 & 6\\
-3 & 6 & 4 & -3 & 3 & -4 & -6 & 3 & 4 & -6 & 6 & 32 & 3 & -6 & -10 & 3 & -3 & -8 & 6 & -3 & -10 & 6 & -6 & -8\\
4 & 3 & 6 & -10 & -3 & -6 & -8 & -3 & -3 & -4 & 3 & 3 & 32 & 6 & 6 & -8 & -6 & -6 & -10 & -6 & -3 & 4 & 6 & 3\\
3 & 4 & 6 & 3 & -4 & 3 & -3 & -8 & -3 & -3 & -10 & -6 & 6 & 32 & 6 & 6 & 4 & 3 & -6 & -10 & -3 & -6 & -8 & -6\\
-6 & -6 & -8 & -6 & -3 & -10 & -3 & -3 & -8 & -3 & -6 & -10 & 6 & 6 & 32 & 6 & 3 & 4 & 3 & 3 & -4 & 3 & 6 & 4\\
-10 & 3 & 6 & 4 & -3 & -6 & -4 & -3 & -3 & -8 & 3 & 3 & -8 & 6 & 6 & 32 & -6 & -6 & 4 & -6 & -3 & -10 & 6 & 3\\
-3 & -4 & 3 & -3 & 4 & 6 & 3 & -10 & -6 & 3 & -8 & -3 & -6 & 4 & 3 & -6 & 32 & 6 & 6 & -8 & -6 & 6 & -10 & -3\\
6 & -3 & -10 & 6 & -6 & -8 & 3 & -6 & -10 & 3 & -3 & -8 & -6 & 3 & 4 & -6 & 6 & 32 & -3 & 6 & 4 & -3 & 3 & -4\\
-8 & -3 & 3 & -4 & 3 & -3 & 4 & 3 & -6 & -10 & -3 & 6 & -10 & -6 & 3 & 4 & 6 & -3 & 32 & 6 & -6 & -8 & -6 & 6\\
-3 & -8 & 3 & -3 & -10 & 6 & 3 & 4 & -6 & 3 & -4 & -3 & -6 & -10 & 3 & -6 & -8 & 6 & 6 & 32 & -6 & 6 & 4 & -3\\
3 & 3 & -8 & 3 & 6 & -10 & 6 & 6 & -8 & 6 & 3 & -10 & -3 & -3 & -4 & -3 & -6 & 4 & -6 & -6 & 32 & -6 & -3 & 4\\
-4 & -3 & 3 & -8 & 3 & -3 & -10 & 3 & -6 & 4 & -3 & 6 & 4 & -6 & 3 & -10 & 6 & -3 & -8 & 6 & -6 & 32 & -6 & 6\\
3 & -10 & 6 & 3 & -8 & 3 & -3 & -4 & -3 & -3 & 4 & -6 & 6 & -8 & 6 & 6 & -10 & 3 & -6 & 4 & -3 & -6 & 32 & -6\\
-3 & 6 & -10 & -3 & 3 & -8 & -6 & 3 & -10 & -6 & 6 & -8 & 3 & -6 & 4 & 3 & -3 & -4 & 6 & -3 & 4 & 6 & -6 & 32
\end{bmatrix}$$

In both cases, the matrix is lacking the factor to change coordinates $L/8$ and are multiplied by 36 to make numbers prettier. Still, after all this cosmetic manipulation of the computation, it is not practical to use these $24\times 24$ matrices explicitly.
